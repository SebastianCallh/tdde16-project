  :PROPERTIES:
  :header-args: :eval never-export
  :header-args:bash: :exports code
  :header-args:elisp: :exports code
  :header-args:ipython: :exports both
  :END:

#+BEGIN_SRC bash :dir ~/.venv/ :results drawer
  pwd
  virtualenv -p python3 tdde16
#+END_SRC

#+BEGIN_SRC elisp :results silent
  (pyvenv-activate "~/.venv/tdde16")
#+END_SRC

#+BEGIN_SRC bash :results drawer :async t
  pip install ipython jupyter_client jupyter_console numpy matplotlib pandas sklearn gensim seaborn cython
#+END_SRC

#+begin_src ipython  :results drawer :async t :session s :exports output
  %matplotlib inline
  import pandas as pd
  import numpy as np
  np.random.seed(1)
  cats = ['severe_toxic', 'obscene', 'threat', 'insult', 'identity_hate']
  train = pd.read_csv('./toxic/train.csv')
  X = train.comment_text
  y = train[cats]
  print(X.shape)
  print(y.head())
#+end_src

#+RESULTS:
:RESULTS:
# Out[8]:
:END:


#+BEGIN_SRC ipython :session s
  from gensim.models import FastText
  from sklearn.naive_bayes import ComplementNB
  X = train.comment_text
  y = train[cats]
  ft = FastText(X, size=4, window=3, min_count=1, iter=10)
  fname = "./toxic/fasttext.model"
  ft.save(fname)
#+END_SRC

#+BEGIN_SRC ipython :session s
  import multiprocessing
  from gensim.models.doc2vec import Doc2Vec, TaggedDocument
  cores = multiprocessing.cpu_count()
  size = 100
  docs = [TaggedDocument(doc, [tag]) for tag, doc in enumerate(X)]
  d2v = Doc2Vec(
      docs,
      vector_size=size,
      window=10,
      min_count=2,
      workers=cores,
      hs=0,
      sample=0,
      alpha=0.05)
  d2v.train(docs, total_examples=len(docs), epochs=10)
#+END_SRC

#+RESULTS:
: # Out[9]:
: : <gensim.models.fasttext.FastText at 0x7fd37b39bc18>
#+BEGIN_SRC ipython :session s
  from gensim.models import FastText
  ft = FastText.load("./toxic/fasttext.model")
  print(X[:10])
  #  X  = np.array([ft[x] for x in X[:10]])


  # nb = ComplementNB()
  # nb.fit(X, y)
  # preds = np.predict()
  # print(metrics.classification_report(
  #     y_test, 
  #     preds))
#+END_SRC

#+RESULTS:
: # Out[28]:

